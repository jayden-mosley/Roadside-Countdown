<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roadside Countdown</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      overflow-x: hidden;
    }

    #starfield, #dayfield {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: twinkle 2s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }

    .shooting-star {
      position: absolute;
      width: 100px;
      height: 2px;
      background: white;
      transform: rotate(45deg);
      animation: shoot 1s linear;
    }

    @keyframes shoot {
      0% { transform: translateX(-200px) translateY(-200px) rotate(45deg); opacity: 1; }
      100% { transform: translateX(100vw) translateY(100vh) rotate(45deg); opacity: 0; }
    }

    #inputForm {
      padding: 1rem;
      text-align: center;
    }

    #inputForm input {
      padding: 0.5rem;
      font-size: 1.2rem;
    }

    #timers {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
    }

    .vehicle-timer {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 1rem;
      width: 300px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }

    .bird {
      position: absolute;
      width: 40px;
      animation: fly linear forwards;
    }

    @keyframes fly {
      from { transform: translateX(-100px); }
      to { transform: translateX(110vw); }
    }
  </style>
</head>
<body>
  <div id="starfield"></div>
  <div id="dayfield"></div>

  <div id="inputForm">
    <input type="text" id="regInput" placeholder="Enter REG" />
    <button onclick="addVehicle()">Start Timers</button>
  </div>

  <div id="timers"></div>

  <audio id="twinkleSound" src="https://www.myinstants.com/media/sounds/twinkle.mp3"></audio>

  <script>
    const vehicles = {};

    function addVehicle() {
      const reg = document.getElementById('regInput').value.trim().toUpperCase();
      if (!reg || vehicles[reg]) return;

      const container = document.createElement('div');
      container.className = 'vehicle-timer';
      container.innerHTML = `
        <h3>${reg}</h3>
        <p>Countdown: <span id="countdown-${reg}">30:00</span></p>
        <p>Recovery: <span id="recovery-${reg}">00:00</span></p>
        <button onclick="resetCountdown('${reg}')">Reset Countdown</button>
        <button onclick="resetRecovery('${reg}')">Reset Recovery</button>
      `;
      document.getElementById('timers').appendChild(container);

      vehicles[reg] = {
        countdownStart: Date.now(),
        recoveryStart: Date.now(),
        countdownExpired: false,
      };
    }

    function resetCountdown(reg) {
      vehicles[reg].countdownStart = Date.now();
      vehicles[reg].countdownExpired = false;
    }

    function resetRecovery(reg) {
      vehicles[reg].recoveryStart = Date.now();
    }

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const seconds = String(totalSeconds % 60).padStart(2, '0');
      return `${minutes}:${seconds}`;
    }

    function updateTimers() {
      const now = Date.now();
      for (const reg in vehicles) {
        const data = vehicles[reg];
        const cdElapsed = now - data.countdownStart;
        const rcElapsed = now - data.recoveryStart;

        const countdownLeft = 30 * 60 * 1000 - cdElapsed;
        const cdElem = document.getElementById(`countdown-${reg}`);
        const rcElem = document.getElementById(`recovery-${reg}`);

        if (cdElem && rcElem) {
          cdElem.textContent = countdownLeft > 0 ? formatTime(countdownLeft) : '00:00';
          rcElem.textContent = formatTime(rcElapsed);

          if (countdownLeft <= 0 && !data.countdownExpired) {
            data.countdownExpired = true;
            notifyUser(reg);
          }
        }
      }
      requestAnimationFrame(updateTimers);
    }

    function notifyUser(reg) {
      const audio = document.getElementById('twinkleSound');
      if (audio) audio.play();
      if (Notification.permission === 'granted') {
        new Notification(`30min timer expired for ${reg}`);
      }
    }

    if (Notification.permission !== 'granted') {
      Notification.requestPermission();
    }

    function createStars() {
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.top = `${Math.random() * 100}%`;
        star.style.left = `${Math.random() * 100}%`;
        document.getElementById('starfield').appendChild(star);
      }
    }

    function createShootingStar() {
      const star = document.createElement('div');
      star.className = 'shooting-star';
      star.style.top = `${Math.random() * window.innerHeight}px`;
      star.style.left = `-${Math.random() * 200}px`;
      document.getElementById('starfield').appendChild(star);
      setTimeout(() => star.remove(), 1000);
    }

    function spawnBird() {
      const bird = document.createElement('img');
      bird.src = 'https://i.imgur.com/O7YtG8B.png';
      bird.className = 'bird';
      bird.style.top = `${Math.random() * 60 + 10}%`;
      bird.style.animationDuration = `${10 + Math.random() * 10}s`;
      document.getElementById('dayfield').appendChild(bird);
      setTimeout(() => bird.remove(), 20000);
    }

    function spawnBirdsRandomly() {
      spawnBird();
      setTimeout(spawnBirdsRandomly, 5000 + Math.random() * 10000);
    }

    const hour = new Date().getHours();
    if (hour >= 6 && hour < 17) {
      document.getElementById('dayfield').style.background = 'linear-gradient(to top, #87cefa, #fff)';
      spawnBirdsRandomly();
    } else {
      createStars();
      setInterval(createShootingStar, 4000 + Math.random() * 4000);
    }

    updateTimers();
  </script>
</body>
</html>
