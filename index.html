<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EFM Roadside Countdown</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: linear-gradient(to top, #d0eaff, #ffffff);
      overflow-x: hidden;
      color: #333;
    }
    .container {
      padding: 1rem;
    }
    #regForm {
      margin-bottom: 1rem;
    }
    .vehicle {
      background: rgba(255, 255, 255, 0.8);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .bird {
      position: fixed;
      top: 0;
      width: 40px;
      height: auto;
      z-index: 20;
      pointer-events: none;
      animation-name: fly;
      animation-timing-function: linear;
    }
    @keyframes fly-left {
      from {
        transform: translateX(100vw) scaleX(1);
      }
      to {
        transform: translateX(-100px) scaleX(1);
      }
    }
    @keyframes fly-right {
      from {
        transform: translateX(-100px) scaleX(-1);
      }
      to {
        transform: translateX(100vw) scaleX(-1);
      }
    }
    .starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    .dark {
      background: radial-gradient(#000010, #000000);
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="regForm">
      <input type="text" id="regInput" placeholder="Enter REG" required />
      <button type="submit">Add Vehicle</button>
    </form>
    <div id="vehicleContainer"></div>
  </div>
  <div id="starfield" class="starfield"></div>

  <script>
    const vehicleContainer = document.getElementById("vehicleContainer");
    const starfield = document.getElementById("starfield");

    function createTimer(reg) {
      const wrapper = document.createElement("div");
      wrapper.className = "vehicle";

      const label = document.createElement("h3");
      label.textContent = reg;

      const countdown = document.createElement("p");
      countdown.textContent = "30:00";

      const recovery = document.createElement("p");
      recovery.textContent = "Recovered: 00:00";

      const reset30 = document.createElement("button");
      reset30.textContent = "Reset 30min";

      const stopRecovery = document.createElement("button");
      stopRecovery.textContent = "Stop Recovery Timer";

      wrapper.append(label, countdown, reset30, recovery, stopRecovery);
      vehicleContainer.appendChild(wrapper);

      let countdownTime = 30 * 60;
      let recoveryTime = 0;
      let recoveryInterval;

      function updateCountdown() {
        const minutes = Math.floor(countdownTime / 60).toString().padStart(2, '0');
        const seconds = (countdownTime % 60).toString().padStart(2, '0');
        countdown.textContent = `${minutes}:${seconds}`;
        if (countdownTime > 0) {
          countdownTime--;
        } else {
          playTwinkle();
          notify(reg);
        }
      }

      function updateRecovery() {
        recoveryTime++;
        const minutes = Math.floor(recoveryTime / 60).toString().padStart(2, '0');
        const seconds = (recoveryTime % 60).toString().padStart(2, '0');
        recovery.textContent = `Recovered: ${minutes}:${seconds}`;
      }

      const countdownInterval = setInterval(updateCountdown, 1000);
      recoveryInterval = setInterval(updateRecovery, 1000);

      reset30.onclick = () => {
        countdownTime = 30 * 60;
      };

      stopRecovery.onclick = () => {
        clearInterval(recoveryInterval);
      };
    }

    document.getElementById("regForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const reg = document.getElementById("regInput").value.trim();
      if (reg) {
        createTimer(reg);
        document.getElementById("regInput").value = "";
      }
    });

    function playTwinkle() {
      const audio = new Audio("https://freesound.org/data/previews/341/341695_5260877-lq.mp3");
      audio.play();
    }

    function notify(reg) {
      if (document.visibilityState === 'hidden') {
        const notification = new Notification(`⏰ 30min reached for ${reg}`);
      }
    }

    if (Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    function setDayNightMode() {
      const hour = new Date().getHours();
      if (hour >= 17 || hour < 6) {
        document.body.classList.add("dark");
        starfield.style.background = "radial-gradient(black, #111)");
      } else {
        document.body.classList.remove("dark");
        starfield.style.background = "linear-gradient(to top, #d0eaff, #ffffff)";
      }
    }

    function spawnBird() {
      const bird = document.createElement('img');
      bird.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAUCAMAAADlUj4bAAAAM1BMVEUAAAB/f3+AgID///+ZmZn8/PzZ2dnKysq8vLz4+PjY2Ni+vr7p6enq6urc3Nzv7+/R0dGtXMCZAAAAD3RSTlMA5PAAfRgZGf779goJ/DsxNDfjQAAAQElEQVR42mNgoBL4YwACRBkZGRmZAAEQwMDABGSkpGhprGyQEGgA0LFy5ckAJCIwaMiQJULFwJ+vTp0wMCHFu2bNHBg1aqVEFCxcqUKVOmTrBq0SI6ePUqQIQ1FQcYAJWYlKkyfQWjAAAAAElFTkSuQmCC';
      bird.classList.add('bird');

      const direction = Math.random() < 0.5 ? 'left' : 'right';
      const verticalPosition = Math.random() * window.innerHeight * 0.6;
      const duration = 10 + Math.random() * 10;

      bird.style.top = `${verticalPosition}px`;
      bird.style.animationDuration = `${duration}s`;
      bird.style.animationName = direction === 'left' ? 'fly-left' : 'fly-right';

      document.body.appendChild(bird);

      setTimeout(() => {
        bird.remove();
      }, duration * 1000);
    }

    function startBirds() {
      const hour = new Date().getHours();
      if (hour >= 6 && hour < 17) {
        setInterval(() => {
          spawnBird();
        }, 5000 + Math.random() * 10000);
      }
    }

    window.onload = () => {
      setDayNightMode();
      startBirds();
    };
  </script>
</body>
</html>
